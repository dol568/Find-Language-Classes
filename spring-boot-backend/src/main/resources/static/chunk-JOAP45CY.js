import{a as F,c as L,d as N,e as T}from"./chunk-O76YKP7P.js";import{a as A,h as I}from"./chunk-6ITZPGEO.js";import{K as u,Kb as C,Lb as H,N as z,R as w,Rb as P,Vb as R,a as _,b as v,d as t,e as a,f as n,q as m,sb as k,va as y}from"./chunk-4EKNMXJU.js";var J=(()=>{var r,S,b,p,g,f,o,l,U,h;let d=class d{constructor(){a(this,r,void 0);a(this,S,void 0);a(this,b,void 0);a(this,p,void 0);a(this,g,void 0);a(this,f,void 0);a(this,o,void 0);a(this,l,void 0);a(this,U,void 0);a(this,h,void 0);n(this,r,w(H)),n(this,S,w(P)),n(this,b,w(R)),n(this,p,F),n(this,g,t(this,p)+"follow"),n(this,f,t(this,p)+"profiles"),n(this,o,y(null)),n(this,l,y(void 0)),n(this,U,y(void 0)),n(this,h,y(!1)),this.currentUser=k(t(this,o)),this.profile=k(t(this,l)),this.photo=k(t(this,U)),this.loadCurrentUser()}loadCurrentUser(){let s=sessionStorage.getItem(I);if(s===null)return t(this,o).set(null),t(this,h).set(!1),null;let e=new C;return e=e.set("Authorization",`Bearer ${s}`),t(this,r).get(t(this,p)+L,{headers:e}).pipe(m(i=>{let c=i.data;c?(sessionStorage.setItem(I,c.token),t(this,o).set(c),t(this,h).set(!0)):(t(this,h).set(!1),t(this,o).set(null))}))}isAuthenticatedUser(){return t(this,h).call(this)}login(s){return t(this,r).post(t(this,p)+N,s).pipe(u(e=>{let i=e.data;i&&(sessionStorage.setItem(I,i.token),t(this,o).set(i),t(this,h).set(!0))}))}register(s){return t(this,r).post(t(this,p)+T,s).pipe(u(e=>{let i=e.data;i&&(sessionStorage.setItem(I,i.token),t(this,o).set(i),t(this,h).set(!0))}))}logout(){sessionStorage.removeItem(I),t(this,o).set(null),t(this,h).set(!1),t(this,b).navigate([A])}profile$(s){return t(this,r).get(t(this,f)+"/"+s).pipe(u(e=>{t(this,l).set(e.data)}))}updateProfile(s,e){return t(this,r).put(t(this,f)+"/"+s,e).pipe(m(i=>i.data),u(i=>{t(this,o).update(c=>v(_({},c),{fullName:i.fullName})),t(this,l).set(i)}))}uploadPhoto(s){return t(this,r).put(t(this,f)+"/photo",s).pipe(m(e=>e.data),u(e=>{let i=_({},this.currentUser());i.photoUrl=e,t(this,o).set(i),t(this,l).update(c=>v(_({},c),{photoUrl:e}))}))}loadPhoto(s){return t(this,r).get(s,{responseType:"blob"}).pipe(m(e=>t(this,S).bypassSecurityTrustUrl(URL.createObjectURL(e))),u(e=>{t(this,U).set(e)}))}followUser(s){return t(this,r).post(t(this,g)+"/"+s,null).pipe(m(e=>e.data),u(e=>{t(this,l).set(e)}))}unFollowUser(s){return t(this,r).delete(t(this,g)+"/"+s).pipe(m(e=>e.data),u(e=>{t(this,l).set(e)}))}};r=new WeakMap,S=new WeakMap,b=new WeakMap,p=new WeakMap,g=new WeakMap,f=new WeakMap,o=new WeakMap,l=new WeakMap,U=new WeakMap,h=new WeakMap,d.\u0275fac=function(e){return new(e||d)},d.\u0275prov=z({token:d,factory:d.\u0275fac,providedIn:"root"});let j=d;return j})();export{J as a};
