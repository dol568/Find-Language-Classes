import{K as m,Lb as A,N as z,Nb as C,Q as F,R as w,Tb as L,Xb as D,a as E,ac as N,b as R,d as t,e as l,f as p,g as T,hc as $,jc as O,kc as y,o as H,q as U,tb as v,wa as x}from"./chunk-O2XDBLWT.js";var B={production:!0,apiUrl:"/api/"};var K=B.apiUrl,Y="languageClasses",q="users",G="login",J="register";var M=(()=>{var o;let c=class c{constructor(a){l(this,o,void 0);this.http=a,this._cacheUrls=[],this._cachedImages={"":`${O}/user.jpg`,french:`${y}/french.jpg`,english:`${y}/english.jpg`,german:`${y}/german.jpg`,italian:`${y}/italian.jpg`,polish:`${y}/polish.jpg`,spanish:`${y}/spanish.jpg`},p(this,o,w(L))}set cacheUrls(a){this._cacheUrls=[...a]}get cacheUrls(){return this._cacheUrls}getImage(a){return a?(a=a.toLowerCase(),a in this._cachedImages?(console.log("inside cache images"),H(this._cachedImages[a])):this.http.get(a,{responseType:"blob"}).pipe(U(n=>t(this,o).bypassSecurityTrustUrl(URL.createObjectURL(n))),m(n=>{console.log("http call images"),this._cachedImages[a]=n}))):H(this._cachedImages[""])}};o=new WeakMap,c.\u0275fac=function(n){return new(n||c)(F(C))},c.\u0275prov=z({token:c,factory:c.\u0275fac,providedIn:"root"});let b=c;return b})();var Ut=(()=>{var o,c,h,a,n,S,I,g,f,_,d,u,k,Q;let j=class j{constructor(){l(this,k);l(this,o,void 0);l(this,c,void 0);l(this,h,void 0);l(this,a,void 0);l(this,n,void 0);l(this,S,void 0);l(this,I,void 0);l(this,g,void 0);l(this,f,void 0);l(this,_,void 0);l(this,d,void 0);l(this,u,void 0);p(this,o,w(C)),p(this,c,w(L)),p(this,h,w(M)),p(this,a,w(D)),p(this,n,K),p(this,S,t(this,n)+"follow"),p(this,I,t(this,n)+"profiles"),p(this,g,x(null)),p(this,f,x(void 0)),p(this,_,x(void 0)),p(this,d,x(void 0)),p(this,u,x(!1)),this.currentUser=v(t(this,g)),this.profile=v(t(this,f)),this.photo=v(t(this,_)),this.loggedInUserPhoto=v(t(this,d))}loadCurrentUser(){let r=sessionStorage.getItem($);if(r===null)return t(this,g).set(null),t(this,u).set(!1),null;let e=new A;return e=e.set("Authorization",`Bearer ${r}`),t(this,o).get(t(this,n)+q,{headers:e}).pipe(U(s=>{let i=s.data;i?(sessionStorage.setItem($,i.token),t(this,h).getImage(i?.photoUrl).subscribe(P=>{i.photoUrl=P}),t(this,g).set(i),t(this,h).getImage(i?.photoUrl).subscribe(P=>{t(this,d).set(P)}),t(this,u).set(!0)):(t(this,u).set(!1),t(this,g).set(null))}))}isAuthenticatedUser(){return t(this,u).call(this)}login(r){return t(this,o).post(t(this,n)+G,r).pipe(m(e=>{let s=e.data;s&&(sessionStorage.setItem($,s.token),t(this,g).set(s),t(this,u).set(!0),t(this,h).getImage(s.photoUrl).subscribe(i=>{t(this,d).set(i)}))}))}register(r){return t(this,o).post(t(this,n)+J,r).pipe(m(e=>{let s=e.data;s&&(sessionStorage.setItem($,s.token),t(this,g).set(s),t(this,u).set(!0),t(this,h).getImage(s.photoUrl).subscribe(i=>{t(this,d).set(i)}))}))}logout(){sessionStorage.removeItem($),t(this,g).set(null),t(this,u).set(!1),t(this,a).navigate([N])}profile$(r){return t(this,o).get(t(this,I)+"/"+r).pipe(m(e=>{t(this,h).getImage(e.data.photoUrl).subscribe(s=>{t(this,_).set(s)}),e.data.followers.forEach(s=>{t(this,h).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),e.data.followings.forEach(s=>{t(this,h).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),t(this,f).set(e.data)}))}updateProfile(r,e){return t(this,o).put(t(this,I)+"/"+r,e).pipe(U(s=>s.data),m(s=>{t(this,g).update(i=>R(E({},i),{fullName:s.fullName})),t(this,f).set(s)}))}uploadPhoto(r){return t(this,o).put(t(this,I)+"/photo",r).pipe(U(e=>e.data),m(e=>{let s=E({},this.currentUser());s.photoUrl=e,T(this,k,Q).call(this,e).subscribe(i=>{t(this,_).set(i),t(this,d).set(i)}),t(this,g).set(s),t(this,f).update(i=>R(E({},i),{photoUrl:e}))}))}followUser(r){return t(this,o).post(t(this,S)+"/"+r,null).pipe(U(e=>e.data),m(e=>{e.followers.forEach(s=>{t(this,h).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),e.followings.forEach(s=>{t(this,h).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),t(this,f).set(e)}))}unFollowUser(r){return t(this,o).delete(t(this,S)+"/"+r).pipe(U(e=>e.data),m(e=>{e.followers.forEach(s=>{t(this,h).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),e.followings.forEach(s=>{t(this,h).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),t(this,f).set(e)}))}};o=new WeakMap,c=new WeakMap,h=new WeakMap,a=new WeakMap,n=new WeakMap,S=new WeakMap,I=new WeakMap,g=new WeakMap,f=new WeakMap,_=new WeakMap,d=new WeakMap,u=new WeakMap,k=new WeakSet,Q=function(r){return t(this,o).get(r,{responseType:"blob"}).pipe(U(e=>t(this,c).bypassSecurityTrustUrl(URL.createObjectURL(e))),m(e=>{console.log(e),t(this,h)._cachedImages[r]=e}))},j.\u0275fac=function(e){return new(e||j)},j.\u0275prov=z({token:j,factory:j.\u0275fac,providedIn:"root"});let b=j;return b})();export{K as a,Y as b,M as c,Ut as d};
