import{K as m,Lb as E,N as C,Nb as L,Q as D,R as y,Tb as P,Xb as N,a as z,ac as O,b as H,d as t,e as h,f as p,g as T,hc as $,jc as B,kc as S,o as A,q as U,tb as k,wa as x}from"./chunk-F42N7V6T.js";var K={production:!0,apiUrl:"/api/"};var q=K.apiUrl,Y="languageClasses",G="users",J="login",M="register";var Q=(()=>{var r;let l=class l{constructor(a){h(this,r,void 0);this.http=a,this._cacheUrls=[],this._cachedImages={"":`${B}/user.jpg`,french:`${S}/french.jpg`,english:`${S}/english.jpg`,german:`${S}/german.jpg`,italian:`${S}/italian.jpg`,polish:`${S}/polish.jpg`,spanish:`${S}/spanish.jpg`},p(this,r,y(P))}set cacheUrls(a){this._cacheUrls=[...a]}get cacheUrls(){return this._cacheUrls}getImage(a){return console.log(a),a=a.toLowerCase(),a in this._cachedImages?(console.log("inside cache images"),A(this._cachedImages[a])):this.http.get(a,{responseType:"blob"}).pipe(U(n=>t(this,r).bypassSecurityTrustUrl(URL.createObjectURL(n))),m(n=>{console.log("http call images"),this._cachedImages[a]=n}))}};r=new WeakMap,l.\u0275fac=function(n){return new(n||l)(D(L))},l.\u0275prov=C({token:l,factory:l.\u0275fac,providedIn:"root"});let _=l;return _})();var Ut=(()=>{var r,l,u,a,n,w,b,c,f,I,d,g,v,F;let j=class j{constructor(){h(this,v);h(this,r,void 0);h(this,l,void 0);h(this,u,void 0);h(this,a,void 0);h(this,n,void 0);h(this,w,void 0);h(this,b,void 0);h(this,c,void 0);h(this,f,void 0);h(this,I,void 0);h(this,d,void 0);h(this,g,void 0);p(this,r,y(L)),p(this,l,y(P)),p(this,u,y(Q)),p(this,a,y(N)),p(this,n,q),p(this,w,t(this,n)+"follow"),p(this,b,t(this,n)+"profiles"),p(this,c,x(null)),p(this,f,x(void 0)),p(this,I,x(void 0)),p(this,d,x(void 0)),p(this,g,x(!1)),this.currentUser=k(t(this,c)),this.profile=k(t(this,f)),this.photo=k(t(this,I)),this.loggedInUserPhoto=k(t(this,d))}loadCurrentUser(){let o=sessionStorage.getItem($);if(o===null)return t(this,c).set(null),t(this,g).set(!1),null;let e=new E;return e=e.set("Authorization",`Bearer ${o}`),t(this,r).get(t(this,n)+G,{headers:e}).pipe(U(s=>{let i=s.data;i?(sessionStorage.setItem($,i.token),t(this,u).getImage(i?.photoUrl).subscribe(R=>{i.photoUrl=R}),t(this,c).set(i),t(this,u).getImage(i?.photoUrl).subscribe(R=>{t(this,d).set(R)}),t(this,g).set(!0)):(t(this,g).set(!1),t(this,c).set(null))}))}isAuthenticatedUser(){return t(this,g).call(this)}login(o){return t(this,r).post(t(this,n)+J,o).pipe(m(e=>{let s=e.data;s&&(sessionStorage.setItem($,s.token),t(this,c).set(s),t(this,g).set(!0),t(this,u).getImage(s.photoUrl).subscribe(i=>{t(this,d).set(i)}))}))}register(o){return t(this,r).post(t(this,n)+M,o).pipe(m(e=>{let s=e.data;s&&(sessionStorage.setItem($,s.token),t(this,c).set(s),t(this,g).set(!0),T(this,v,F).call(this,s.photoUrl).subscribe(i=>{t(this,d).set(i)}))}))}logout(){sessionStorage.removeItem($),t(this,c).set(null),t(this,g).set(!1),t(this,a).navigate([O])}profile$(o){return t(this,r).get(t(this,b)+"/"+o).pipe(m(e=>{t(this,u).getImage(e.data.photoUrl).subscribe(s=>{t(this,I).set(s)}),e.data.followers.forEach(s=>{t(this,u).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),e.data.followings.forEach(s=>{t(this,u).getImage(s.photoUrl).subscribe(i=>s.photoUrl=i)}),t(this,f).set(e.data)}))}updateProfile(o,e){return t(this,r).put(t(this,b)+"/"+o,e).pipe(U(s=>s.data),m(s=>{t(this,c).update(i=>H(z({},i),{fullName:s.fullName})),t(this,f).set(s)}))}uploadPhoto(o){return t(this,r).put(t(this,b)+"/photo",o).pipe(U(e=>e.data),m(e=>{let s=z({},this.currentUser());s.photoUrl=e,T(this,v,F).call(this,e).subscribe(i=>{t(this,I).set(i),t(this,d).set(i)}),t(this,c).set(s),t(this,f).update(i=>H(z({},i),{photoUrl:e}))}))}followUser(o){return t(this,r).post(t(this,w)+"/"+o,null).pipe(U(e=>e.data),m(e=>{t(this,f).set(e)}))}unFollowUser(o){return t(this,r).delete(t(this,w)+"/"+o).pipe(U(e=>e.data),m(e=>{t(this,f).set(e)}))}};r=new WeakMap,l=new WeakMap,u=new WeakMap,a=new WeakMap,n=new WeakMap,w=new WeakMap,b=new WeakMap,c=new WeakMap,f=new WeakMap,I=new WeakMap,d=new WeakMap,g=new WeakMap,v=new WeakSet,F=function(o){return t(this,r).get(o,{responseType:"blob"}).pipe(U(e=>t(this,l).bypassSecurityTrustUrl(URL.createObjectURL(e))),m(e=>{console.log(e),t(this,u)._cachedImages[o]=e}))},j.\u0275fac=function(e){return new(e||j)},j.\u0275prov=C({token:j,factory:j.\u0275fac,providedIn:"root"});let _=j;return _})();export{q as a,Y as b,Q as c,Ut as d};
