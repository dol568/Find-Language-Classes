import{K as m,Lb as A,N as k,Nb as T,Q as F,R as y,Tb as z,Xb as D,a as v,ac as N,b as P,d as t,e as h,f as n,g as H,hc as C,jc as O,kc as R,o as $,q as f,tb as L,wa as j}from"./chunk-IUDINDPP.js";var B={production:!0,apiUrl:"/api/"};var K=B.apiUrl,Y="languageClasses",q="users",E="login",G="register";var J=(()=>{var i;let p=class p{constructor(s){h(this,i,void 0);this.http=s,this._cacheUrls=[],this._cachedImages={},n(this,i,y(z))}set cacheUrls(s){this._cacheUrls=[...s]}get cacheUrls(){return this._cacheUrls}getImage(s){return!s||s.trim()===""?$(t(this,i).bypassSecurityTrustUrl(`${O}/user.jpg`)):s.toLowerCase()==="french"||s.toLowerCase()==="english"||s.toLowerCase()==="german"||s.toLowerCase()==="italian"||s.toLowerCase()==="polish"||s.toLowerCase()==="spanish"?(console.log(`${R}/${s?.toLowerCase()}.jpg`),$(t(this,i).bypassSecurityTrustUrl(`${R}/${s?.toLowerCase()}.jpg`))):(console.log(this._cachedImages),s in this._cachedImages?(console.log("hi"),$(this._cachedImages[s])):this.http.get(s,{responseType:"blob"}).pipe(f(a=>t(this,i).bypassSecurityTrustUrl(URL.createObjectURL(a))),m(a=>{console.log(a),this._cachedImages[s]=a,console.log(this._cachedImages)})))}};i=new WeakMap,p.\u0275fac=function(a){return new(a||p)(F(T))},p.\u0275prov=k({token:p,factory:p.\u0275fac,providedIn:"root"});let d=p;return d})();var Ut=(()=>{var i,p,U,s,a,S,_,c,g,I,b,l,x,M;let w=class w{constructor(){h(this,x);h(this,i,void 0);h(this,p,void 0);h(this,U,void 0);h(this,s,void 0);h(this,a,void 0);h(this,S,void 0);h(this,_,void 0);h(this,c,void 0);h(this,g,void 0);h(this,I,void 0);h(this,b,void 0);h(this,l,void 0);n(this,i,y(T)),n(this,p,y(z)),n(this,U,y(J)),n(this,s,y(D)),n(this,a,K),n(this,S,t(this,a)+"follow"),n(this,_,t(this,a)+"profiles"),n(this,c,j(null)),n(this,g,j(void 0)),n(this,I,j(void 0)),n(this,b,j(void 0)),n(this,l,j(!1)),this.currentUser=L(t(this,c)),this.profile=L(t(this,g)),this.photo=L(t(this,I)),this.loggedInUserPhoto=L(t(this,b))}loadCurrentUser(){let o=sessionStorage.getItem(C);if(o===null)return t(this,c).set(null),t(this,l).set(!1),null;let e=new A;return e=e.set("Authorization",`Bearer ${o}`),t(this,i).get(t(this,a)+q,{headers:e}).pipe(f(r=>{let u=r.data;u?(sessionStorage.setItem(C,u.token),t(this,c).set(u),t(this,U).getImage(u?.photoUrl).subscribe(Q=>{t(this,b).set(Q)}),t(this,l).set(!0)):(t(this,l).set(!1),t(this,c).set(null))}))}isAuthenticatedUser(){return t(this,l).call(this)}login(o){return t(this,i).post(t(this,a)+E,o).pipe(m(e=>{let r=e.data;r&&(sessionStorage.setItem(C,r.token),t(this,c).set(r),t(this,l).set(!0))}))}register(o){return t(this,i).post(t(this,a)+G,o).pipe(m(e=>{let r=e.data;r&&(sessionStorage.setItem(C,r.token),t(this,c).set(r),t(this,l).set(!0))}))}logout(){sessionStorage.removeItem(C),t(this,c).set(null),t(this,l).set(!1),t(this,s).navigate([N])}profile$(o){return t(this,i).get(t(this,_)+"/"+o).pipe(m(e=>{t(this,U).getImage(e.data.photoUrl).subscribe(r=>{t(this,I).set(r)}),t(this,g).set(e.data)}))}updateProfile(o,e){return t(this,i).put(t(this,_)+"/"+o,e).pipe(f(r=>r.data),m(r=>{t(this,c).update(u=>P(v({},u),{fullName:r.fullName})),t(this,g).set(r)}))}uploadPhoto(o){return t(this,i).put(t(this,_)+"/photo",o).pipe(f(e=>e.data),m(e=>{let r=v({},this.currentUser());r.photoUrl=e,H(this,x,M).call(this,e).subscribe(u=>{t(this,I).set(u),t(this,b).set(u)}),t(this,c).set(r),t(this,g).update(u=>P(v({},u),{photoUrl:e}))}))}followUser(o){return t(this,i).post(t(this,S)+"/"+o,null).pipe(f(e=>e.data),m(e=>{t(this,g).set(e)}))}unFollowUser(o){return t(this,i).delete(t(this,S)+"/"+o).pipe(f(e=>e.data),m(e=>{t(this,g).set(e)}))}};i=new WeakMap,p=new WeakMap,U=new WeakMap,s=new WeakMap,a=new WeakMap,S=new WeakMap,_=new WeakMap,c=new WeakMap,g=new WeakMap,I=new WeakMap,b=new WeakMap,l=new WeakMap,x=new WeakSet,M=function(o){return t(this,i).get(o,{responseType:"blob"}).pipe(f(e=>t(this,p).bypassSecurityTrustUrl(URL.createObjectURL(e))),m(e=>{console.log(e),t(this,U)._cachedImages[o]=e}))},w.\u0275fac=function(e){return new(e||w)},w.\u0275prov=k({token:w,factory:w.\u0275fac,providedIn:"root"});let d=w;return d})();export{K as a,Y as b,J as c,Ut as d};
