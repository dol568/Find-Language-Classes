import{K as m,Lb as F,N as z,Nb as P,Q as T,R as y,Tb as R,Xb as A,a as v,ac as D,b as $,d as t,e as a,f as n,g as H,hc as C,jc as N,kc as O,o as k,q as g,tb as L,wa as j}from"./chunk-F42N7V6T.js";var B={production:!0,apiUrl:"/api/"};var K=B.apiUrl,Y="languageClasses",q="users",E="login",G="register";var J=(()=>{var o;let p=class p{constructor(s){a(this,o,void 0);this.http=s,this._cacheUrls=[],this._cachedImages={},n(this,o,y(R))}set cacheUrls(s){this._cacheUrls=[...s]}get cacheUrls(){return this._cacheUrls}getImage(s){return!s||s.trim()===""?k(`${N}/user.jpg`):s.toLowerCase()==="french"||s.toLowerCase()==="english"||s.toLowerCase()==="german"||s.toLowerCase()==="italian"||s.toLowerCase()==="polish"||s.toLowerCase()==="spanish"?k(`${O}/${s?.toLowerCase()}.jpg`):(console.log(this._cachedImages),s in this._cachedImages?(console.log("hi"),k(this._cachedImages[s])):this.http.get(s,{responseType:"blob"}).pipe(g(h=>t(this,o).bypassSecurityTrustUrl(URL.createObjectURL(h))),m(h=>{console.log("http"),console.log(s),this._cachedImages[s]=h})))}};o=new WeakMap,p.\u0275fac=function(h){return new(h||p)(T(P))},p.\u0275prov=z({token:p,factory:p.\u0275fac,providedIn:"root"});let d=p;return d})();var _t=(()=>{var o,p,_,s,h,S,U,c,f,I,b,l,x,M;let w=class w{constructor(){a(this,x);a(this,o,void 0);a(this,p,void 0);a(this,_,void 0);a(this,s,void 0);a(this,h,void 0);a(this,S,void 0);a(this,U,void 0);a(this,c,void 0);a(this,f,void 0);a(this,I,void 0);a(this,b,void 0);a(this,l,void 0);n(this,o,y(P)),n(this,p,y(R)),n(this,_,y(J)),n(this,s,y(A)),n(this,h,K),n(this,S,t(this,h)+"follow"),n(this,U,t(this,h)+"profiles"),n(this,c,j(null)),n(this,f,j(void 0)),n(this,I,j(void 0)),n(this,b,j(void 0)),n(this,l,j(!1)),this.currentUser=L(t(this,c)),this.profile=L(t(this,f)),this.photo=L(t(this,I)),this.loggedInUserPhoto=L(t(this,b))}loadCurrentUser(){let i=sessionStorage.getItem(C);if(i===null)return t(this,c).set(null),t(this,l).set(!1),null;let e=new F;return e=e.set("Authorization",`Bearer ${i}`),t(this,o).get(t(this,h)+q,{headers:e}).pipe(g(r=>{let u=r.data;u?(sessionStorage.setItem(C,u.token),t(this,c).set(u),t(this,_).getImage(u?.photoUrl).subscribe(Q=>{t(this,b).set(Q)}),t(this,l).set(!0)):(t(this,l).set(!1),t(this,c).set(null))}))}isAuthenticatedUser(){return t(this,l).call(this)}login(i){return t(this,o).post(t(this,h)+E,i).pipe(m(e=>{let r=e.data;r&&(sessionStorage.setItem(C,r.token),t(this,c).set(r),t(this,l).set(!0))}))}register(i){return t(this,o).post(t(this,h)+G,i).pipe(m(e=>{let r=e.data;r&&(sessionStorage.setItem(C,r.token),t(this,c).set(r),t(this,l).set(!0))}))}logout(){sessionStorage.removeItem(C),t(this,c).set(null),t(this,l).set(!1),t(this,s).navigate([D])}profile$(i){return t(this,o).get(t(this,U)+"/"+i).pipe(m(e=>{t(this,_).getImage(e.data.photoUrl).subscribe(r=>{t(this,I).set(r)}),t(this,f).set(e.data)}))}updateProfile(i,e){return t(this,o).put(t(this,U)+"/"+i,e).pipe(g(r=>r.data),m(r=>{t(this,c).update(u=>$(v({},u),{fullName:r.fullName})),t(this,f).set(r)}))}uploadPhoto(i){return t(this,o).put(t(this,U)+"/photo",i).pipe(g(e=>e.data),m(e=>{let r=v({},this.currentUser());r.photoUrl=e,H(this,x,M).call(this,e).subscribe(u=>{t(this,I).set(u),t(this,b).set(u)}),t(this,c).set(r),t(this,f).update(u=>$(v({},u),{photoUrl:e}))}))}followUser(i){return t(this,o).post(t(this,S)+"/"+i,null).pipe(g(e=>e.data),m(e=>{t(this,f).set(e)}))}unFollowUser(i){return t(this,o).delete(t(this,S)+"/"+i).pipe(g(e=>e.data),m(e=>{t(this,f).set(e)}))}};o=new WeakMap,p=new WeakMap,_=new WeakMap,s=new WeakMap,h=new WeakMap,S=new WeakMap,U=new WeakMap,c=new WeakMap,f=new WeakMap,I=new WeakMap,b=new WeakMap,l=new WeakMap,x=new WeakSet,M=function(i){return t(this,o).get(i,{responseType:"blob"}).pipe(g(e=>t(this,p).bypassSecurityTrustUrl(URL.createObjectURL(e))),m(e=>{console.log(e),t(this,_)._cachedImages[i]=e}))},w.\u0275fac=function(e){return new(e||w)},w.\u0275prov=z({token:w,factory:w.\u0275fac,providedIn:"root"});let d=w;return d})();export{K as a,Y as b,J as c,_t as d};
