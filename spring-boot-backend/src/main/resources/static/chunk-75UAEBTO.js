import{a as F,c as L,d as N,e as T}from"./chunk-CFQIRN3L.js";import{a as A,h as b}from"./chunk-6ITZPGEO.js";import{K as u,Kb as z,Lb as C,N as v,R as w,Rb as H,Vb as R,a as _,b as j,d as t,e as a,f as l,q as m,sb as P,va as y}from"./chunk-4EKNMXJU.js";var J=(()=>{var r,I,S,p,U,f,o,n,g,h;let d=class d{constructor(){a(this,r,void 0);a(this,I,void 0);a(this,S,void 0);a(this,p,void 0);a(this,U,void 0);a(this,f,void 0);a(this,o,void 0);a(this,n,void 0);a(this,g,void 0);a(this,h,void 0);l(this,r,w(C)),l(this,I,w(H)),l(this,S,w(R)),l(this,p,F),l(this,U,t(this,p)+"follow"),l(this,f,t(this,p)+"profiles"),l(this,o,y(null)),l(this,n,y(void 0)),l(this,g,y(void 0)),l(this,h,y(!1)),this.currentUser=P(t(this,o)),this.profile=P(t(this,n)),this.photo=P(t(this,g)),this.loadCurrentUser()}loadCurrentUser(){let s=sessionStorage.getItem(b);if(s===null)return t(this,o).set(null),t(this,h).set(!1),null;let e=new z;return e=e.set("Authorization",`Bearer ${s}`),t(this,r).get(t(this,p)+L,{headers:e}).pipe(m(i=>{let c=i.data;c?(sessionStorage.setItem(b,c.token),t(this,o).set(c),this.loadPhoto(c?.photoUrl).subscribe(),t(this,h).set(!0)):(t(this,h).set(!1),t(this,o).set(null))}))}isAuthenticatedUser(){return t(this,h).call(this)}login(s){return t(this,r).post(t(this,p)+N,s).pipe(u(e=>{let i=e.data;i&&(sessionStorage.setItem(b,i.token),t(this,o).set(i),t(this,h).set(!0))}))}register(s){return t(this,r).post(t(this,p)+T,s).pipe(u(e=>{let i=e.data;i&&(sessionStorage.setItem(b,i.token),t(this,o).set(i),t(this,h).set(!0))}))}logout(){sessionStorage.removeItem(b),t(this,o).set(null),t(this,h).set(!1),t(this,S).navigate([A])}profile$(s){return t(this,r).get(t(this,f)+"/"+s).pipe(u(e=>{this.loadPhoto(e.data.photoUrl).subscribe(),t(this,n).set(e.data)}))}updateProfile(s,e){return t(this,r).put(t(this,f)+"/"+s,e).pipe(m(i=>i.data),u(i=>{t(this,o).update(c=>j(_({},c),{fullName:i.fullName})),t(this,n).set(i)}))}uploadPhoto(s){return t(this,r).put(t(this,f)+"/photo",s).pipe(m(e=>e.data),u(e=>{console.log(this.currentUser());let i=_({},this.currentUser());i.photoUrl=e,this.loadPhoto(e).subscribe(),t(this,o).set(i),console.log(this.currentUser()),t(this,n).update(c=>j(_({},c),{photoUrl:e}))}))}loadPhoto(s){return t(this,r).get(s,{responseType:"blob"}).pipe(m(e=>t(this,I).bypassSecurityTrustUrl(URL.createObjectURL(e))),u(e=>{t(this,g).set(e)}))}followUser(s){return t(this,r).post(t(this,U)+"/"+s,null).pipe(m(e=>e.data),u(e=>{t(this,n).set(e)}))}unFollowUser(s){return t(this,r).delete(t(this,U)+"/"+s).pipe(m(e=>e.data),u(e=>{t(this,n).set(e)}))}};r=new WeakMap,I=new WeakMap,S=new WeakMap,p=new WeakMap,U=new WeakMap,f=new WeakMap,o=new WeakMap,n=new WeakMap,g=new WeakMap,h=new WeakMap,d.\u0275fac=function(e){return new(e||d)},d.\u0275prov=v({token:d,factory:d.\u0275fac,providedIn:"root"});let k=d;return k})();export{J as a};
